{
  "name": "Generar Resumen Import",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Recopilar resultados del robot con datos del pedido original\nconst items = $input.all();\n\nif (items.length === 0) {\n  return [{ json: { mensaje: '', exitosos: 0, fallidos: 0 } }];\n}\n\n// Obtener datos originales del nodo anterior (¬øCiudad V√°lida?)\nconst datosOriginales = $('¬øCiudad V√°lida?').all();\n\nconst exitosos = [];\nconst fallidos = [];\n\nitems.forEach((item, index) => {\n  const robot = item.json;\n  // Buscar datos originales por biginOrderId o por √≠ndice\n  const original = datosOriginales.find(d => d.json.biginOrderId === robot.biginOrderId)?.json || datosOriginales[index]?.json || {};\n  \n  if (robot.success) {\n    exitosos.push({ ...original, ...robot });\n  } else {\n    fallidos.push({ ...original, ...robot });\n  }\n});\n\nlet mensaje = '';\n\nif (exitosos.length > 0) {\n  const detalles = exitosos.map(p => {\n    return `‚Ä¢ *#${p.numeroPedido}* - ${p.nombres || 'N/A'} ${p.apellidos || ''}\n   üìç ${p.direccion || 'N/A'}\n   üèôÔ∏è ${p.ciudad || 'N/A'}\n   üì± ${p.celular || 'N/A'}\n   üí∞ $${p.totalConIva?.toLocaleString() || 'N/A'}`;\n  }).join('\\n\\n');\n  mensaje += `‚úÖ *${exitosos.length} pedido(s) creado(s):*\\n\\n${detalles}`;\n}\n\nif (fallidos.length > 0) {\n  const errores = fallidos.map(p => {\n    return `‚Ä¢ *${p.nombres || p.biginOrderName || 'N/A'} ${p.apellidos || ''}*\n   üì± ${p.celular || 'N/A'}\n   ‚ùå ${p.error || 'Error desconocido'}`;\n  }).join('\\n\\n');\n  mensaje += `\\n\\n‚ùå *${fallidos.length} error(es) del robot:*\\n\\n${errores}`;\n}\n\nreturn [{ json: { mensaje, exitosos: exitosos.length, fallidos: fallidos.length } }];"
      },
      "id": "resumen-resultados",
      "name": "Generar Resumen",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1980, 100]
    }
  ],
  "connections": {},
  "settings": {
    "executionOrder": "v1"
  }
}
