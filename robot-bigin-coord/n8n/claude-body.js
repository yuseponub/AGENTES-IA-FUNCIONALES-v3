// JSON Body para el nodo HTTP de Claude en n8n
// Pegar esto en el campo "JSON Body" del nodo HTTP Request

={{
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 4096,
  "messages": [
    {
      "role": "user",
      "content": "Procesa órdenes de Bigin para Coordinadora. Devuelve SOLO un JSON array.\n\nMAPEO DEPARTAMENTOS→ABREVIATURAS:\nAmazonas=AMAZ, Antioquia=ANT, Arauca=ARAU, Atlántico=ATL, Bolívar=BOL, Boyacá=BOY, Caldas=CDAS, Caquetá=CAQ, Casanare=C/NARE, Cauca=CAU, Cesar=CES, Chocó=CHOCO, Córdoba=CORD, Cundinamarca=C/MARCA, Guainía=GUAI, Guaviare=G/VIARE, Guajira=GUAJ, Huila=HLA, Magdalena=MG/LENA, Meta=META, Nariño=NAR, Norte de Santander=N/STDER, Putumayo=P/MAYO, Quindío=QDIO, Risaralda=RS, San Andrés=S/ANDRES, Santander=STDER, Sucre=SUCRE, Tolima=TOL, Valle del Cauca=VALLE, Valle=VALLE, Vaupés=V/PES, Vichada=VICH\n\nREGLAS EXACTAS:\n\n1. identificacion: Usar campo Telefono. Quitar '57' del inicio si existe. Quitar espacios, guiones, paréntesis, '+'. Resultado DEBE tener 10 dígitos exactos.\n   Ej: '+ 57 316 3709528' → '3163709528'\n   Ej: '573163709528' → '3163709528'\n\n2. nombres: Primera palabra del campo Deal_Name.\n   Ej: 'Juan Perez Garcia' → 'Juan'\n\n3. apellidos: Resto de palabras del Deal_Name. Si solo hay una palabra, usar 'Cliente'.\n   Ej: 'Juan Perez Garcia' → 'Perez Garcia'\n   Ej: 'Maria' → 'Cliente'\n\n4. direccion: Campo Direcci_n exactamente como está.\n\n5. ciudad: CRÍTICO - Formato exacto: 'MUNICIPIO (ABREV)'\n   - Tomar Municipio_Dept, convertir a MAYÚSCULAS\n   - Buscar Departamento en el mapeo y usar su abreviatura\n   - Ej: Municipio_Dept='bucaramanga', Departamento='santander' → 'BUCARAMANGA (STDER)'\n   - Ej: Municipio_Dept='Bogota', Departamento='Cundinamarca' → 'BOGOTA (C/MARCA)'\n   - Ej: Municipio_Dept='Envigado', Departamento='Antioquia' → 'ENVIGADO (ANT)'\n\n6. departamento: Campo Departamento original (para referencia).\n\n7. celular: Igual que identificacion - 10 dígitos sin 57, sin espacios.\n\n8. email: Campo email si existe, sino null.\n\n9. referencia: SIEMPRE 'AA1'\n\n10. unidades:\n    - Si Amount = 77900 → 1\n    - Si Amount = 109900 → 2\n    - Si Amount = 139900 → 3\n    - Si es OTRO valor → buscar en Description el patrón '(X unidad)' o '(X unidades)' y extraer X\n\n11. totalIva: SIEMPRE 0\n\n12. totalConIva: Valor exacto del campo Amount (77900, 109900, 139900, u otro)\n\n13. valorDeclarado: SIEMPRE 55000 (sin importar el valor real)\n\n14. esRecaudoContraentrega: MUY IMPORTANTE\n    - false si Deal_Name contiene '&' (significa que ya pagó)\n    - false si Tag contiene 'PAGO ANTICIPADO'\n    - true en CUALQUIER otro caso (se debe cobrar)\n\n15. peso: SIEMPRE 0.08\n\n16. alto: SIEMPRE 5\n\n17. largo: SIEMPRE 5\n\n18. ancho: SIEMPRE 10\n\n19. biginOrderId: Campo 'id' de la orden\n\n20. biginOrderName: Campo 'Deal_Name'\n\nFormato salida (JSON array):\n[{\"identificacion\":\"3163709528\",\"nombres\":\"Juan\",\"apellidos\":\"Perez\",\"direccion\":\"Calle 123\",\"ciudad\":\"BUCARAMANGA (STDER)\",\"departamento\":\"Santander\",\"celular\":\"3163709528\",\"email\":null,\"referencia\":\"AA1\",\"unidades\":1,\"totalIva\":0,\"totalConIva\":77900,\"valorDeclarado\":55000,\"esRecaudoContraentrega\":true,\"peso\":0.08,\"alto\":5,\"largo\":5,\"ancho\":10,\"biginOrderId\":\"123\",\"biginOrderName\":\"Juan Perez\"}]\n\nÓrdenes a procesar:\n" + JSON.stringify($json.data)
    }
  ]
}
}}
